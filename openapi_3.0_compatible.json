{
  "openapi": "3.0.3",
  "info": {
    "title": "Research Query Processing Tools",
    "description": "AI-powered tools for processing and answering research queries through watsonx Orchestrate",
    "version": "1.0.0"
  },
  "servers": [
    {
      "url": "https://researcher.ngrok.dev",
      "description": "Public API Server (Permanent)"
    }
  ],
  "paths": {
    "/research-pipeline": {
      "post": {
        "summary": "Combined Research Pipeline",
        "description": "Complete research pipeline: takes a question and returns a comprehensive answer",
        "operationId": "combined_research_pipeline",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/CombinedResearchRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/CombinedResearchResponse"
                }
              }
            }
          }
        }
      }
    },
    "/cloud-ratings-sql-execute": {
      "post": {
        "summary": "Cloud Ratings SQL Executor",
        "description": "Generates and executes SQLite queries for cloud ratings database, returning actual results",
        "operationId": "cloud_ratings_sql_executor",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/CloudRatingsSQLExecutionRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/CloudRatingsSQLExecutionResponse"
                }
              }
            }
          }
        }
      }
    },
    "/vector-search": {
      "post": {
        "summary": "Vector Database Search",
        "description": "Performs similarity search on vector database using clarified query and SQL results",
        "operationId": "vector_search",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/VectorSearchRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/VectorSearchResponse"
                }
              }
            }
          }
        }
      }
    },
    "/cohesive-answer": {
      "post": {
        "summary": "Cohesive Answer Generator",
        "description": "Generates comprehensive answers from vector search results",
        "operationId": "cohesive_answer_generator",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/CohesiveAnswerRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/CohesiveAnswerResponse"
                }
              }
            }
          }
        }
      }
    }
  },
  "components": {
    "schemas": {
      "CombinedResearchRequest": {
        "type": "object",
        "required": ["question"],
        "properties": {
          "question": {
            "type": "string",
            "description": "The user's research question"
          },
          "max_clarification_questions": {
            "type": "integer",
            "description": "Maximum clarification questions to ask (0-3)",
            "default": 2
          },
          "max_results": {
            "type": "integer",
            "description": "Maximum number of vector search results",
            "default": 10
          },
          "skip_clarification": {
            "type": "boolean",
            "description": "Skip clarification step and proceed directly",
            "default": false
          }
        }
      },
      "CombinedResearchResponse": {
        "type": "object",
        "required": ["original_question", "final_answer", "sources", "confidence_score", "additional_recommendations", "processing_metadata"],
        "properties": {
          "original_question": {
            "type": "string",
            "description": "The original user question"
          },
          "clarified_query": {
            "type": "string",
            "description": "The clarified query after processing"
          },
          "final_answer": {
            "type": "string",
            "description": "The comprehensive final answer"
          },
          "sources": {
            "type": "array",
            "items": {
              "type": "object",
              "additionalProperties": {
                "type": "string"
              }
            },
            "description": "Sources and references used"
          },
          "confidence_score": {
            "type": "number",
            "description": "Overall confidence in the answer (0-1)"
          },
          "additional_recommendations": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "description": "Additional research suggestions"
          },
          "processing_metadata": {
            "type": "object",
            "additionalProperties": true,
            "description": "Metadata about the processing pipeline"
          }
        }
      },
      "CloudRatingsSQLExecutionRequest": {
        "type": "object",
        "required": ["question"],
        "properties": {
          "question": {
            "type": "string",
            "description": "Natural language question about cloud ratings data"
          },
          "execute_query": {
            "type": "boolean",
            "description": "Whether to execute the generated query",
            "default": true
          },
          "query_type": {
            "type": "string",
            "description": "Type of query: analysis, comparison, ranking, or specific",
            "default": "analysis"
          }
        }
      },
      "CloudRatingsSQLExecutionResponse": {
        "type": "object",
        "required": ["sql_query", "query_results", "column_names", "row_count", "execution_time", "explanation", "confidence_score", "query_type"],
        "properties": {
          "sql_query": {
            "type": "string",
            "description": "Generated SQLite query"
          },
          "query_results": {
            "type": "array",
            "items": {
              "type": "object",
              "additionalProperties": true
            },
            "description": "Actual query execution results"
          },
          "column_names": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "description": "Names of columns in the results"
          },
          "row_count": {
            "type": "integer",
            "description": "Number of rows returned"
          },
          "execution_time": {
            "type": "number",
            "description": "Query execution time in seconds"
          },
          "explanation": {
            "type": "string",
            "description": "Explanation of what the query does"
          },
          "confidence_score": {
            "type": "number",
            "description": "Confidence in query accuracy (0-1)"
          },
          "query_type": {
            "type": "string",
            "description": "Detected type of query"
          }
        }
      },
      "VectorSearchRequest": {
        "type": "object",
        "required": ["clarified_query"],
        "properties": {
          "clarified_query": {
            "type": "string",
            "description": "The user's clarified research question"
          },
          "sql_results": {
            "type": "array",
            "items": {
              "type": "object",
              "additionalProperties": true
            },
            "description": "Results from SQL query execution",
            "default": []
          },
          "max_results": {
            "type": "integer",
            "description": "Maximum number of results to return",
            "default": 10
          }
        }
      },
      "VectorSearchResponse": {
        "type": "object",
        "required": ["results", "total_found", "search_metadata"],
        "properties": {
          "results": {
            "type": "array",
            "items": {
              "type": "object",
              "additionalProperties": true
            },
            "description": "Vector search results with similarity scores"
          },
          "total_found": {
            "type": "integer",
            "description": "Total number of matching documents"
          },
          "search_metadata": {
            "type": "object",
            "additionalProperties": true,
            "description": "Metadata about the search execution"
          }
        }
      },
      "CohesiveAnswerRequest": {
        "type": "object",
        "required": ["original_query", "vector_results"],
        "properties": {
          "original_query": {
            "type": "string",
            "description": "The user's original research question"
          },
          "vector_results": {
            "type": "array",
            "items": {
              "type": "object",
              "additionalProperties": true
            },
            "description": "Results from vector database search"
          },
          "sql_context": {
            "type": "array",
            "items": {
              "type": "object",
              "additionalProperties": true
            },
            "description": "Additional SQL query results",
            "default": []
          }
        }
      },
      "CohesiveAnswerResponse": {
        "type": "object",
        "required": ["answer", "sources", "confidence_score"],
        "properties": {
          "answer": {
            "type": "string",
            "description": "Comprehensive answer to the user's question"
          },
          "sources": {
            "type": "array",
            "items": {
              "type": "object",
              "additionalProperties": {
                "type": "string"
              }
            },
            "description": "Sources and references used"
          },
          "confidence_score": {
            "type": "number",
            "description": "Confidence in the answer quality (0-1)"
          },
          "additional_recommendations": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "description": "Additional research suggestions",
            "default": []
          }
        }
      }
    }
  }
}
